blueprint:
  name: Media Player to ESPHome API
  description: Sends the currently playing media title and artist to an ESPHome device using the specified API service when they change.
  domain: automation
  input:
    media_player:
      name: Media Player
      description: The media player to monitor.
      selector:
        entity:
          domain: media_player
    esphome_device_service:
      name: ESPHome Device Service
      description: The ESPHome service to call (e.g., esphome.tagreader2_set_media_info).
      selector:
        text:

trigger:
  - platform: state
    entity_id: !input media_player
    attribute: media_title
  - platform: state
    entity_id: !input media_player
    attribute: media_artist

condition:
  - condition: template
    value_template: >
      {{ trigger.to_state.attributes.media_title != trigger.from_state.attributes.media_title or
         trigger.to_state.attributes.media_artist != trigger.from_state.attributes.media_artist }}

action:
  - service: !input esphome_device_service
    data:
      title: "{{ state_attr((!input media_player), 'media_title') }}"
      artist: "{{ state_attr((!input media_player), 'media_artist') }}"

mode: single
